#!/bin/sh

PASS=true
ROOT=$PWD

cd $ROOT/fwends-frontend
JAVASCRIPT_FILES=$(git diff --cached --name-only --diff-filter=ACM src/ | grep ".jsx\{0,1\}$")
for FILE in $JAVASCRIPT_FILES
do
    eslint "$ROOT/$FILE"
    if [[ "$?" == 0 ]]; then
        echo "ESLint passed: $FILE"
    else
        echo "ESLint failed: $FILE"
        PASS=false
    fi
done

cd $ROOT/fwends-backend
GO_FILES=$(git diff --cached --name-only --diff-filter=ACM . | grep ".go$")
if [ -n "${GO_FILES}" ]; then
    go vet ./...
    if [[ "$?" == 0 ]]; then
        echo "Go vet passed"
    else
        echo "Go vet failed"
        PASS=false
    fi
    staticcheck ./...
    if [[ "$?" == 0 ]]; then
        echo "Go staticcheck passed"
    else
        echo "Go staticcheck failed"
        PASS=false
    fi
fi

if ! $PASS; then
    exit 1
else
    echo "Pre-commit checks passed"
fi
